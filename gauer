local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local HRP = LocalPlayer.Character:WaitForChild("HumanoidRootPart")
local VirtualInputManager = game:GetService("VirtualInputManager")

-- função de teleport
local function tpTo(pos)
    if HRP and HRP.Parent then
        HRP.CFrame = CFrame.new(pos)
    end
end

-- posições fixas
local jobBoardPos = Vector3.new(-1091.59, 15.08, -935.24)
local jobStep1   = Vector3.new(-387.47, 14.52, -1108.17)
local jobStep2   = Vector3.new(-1099.53, 14.52, -1036.82)
local bankPos    = Vector3.new(-228.91, 16.05, -771.78)

-- pegar job
local function takeJob()
    local prompt = workspace:FindFirstChild("Job Board")
    if prompt and prompt:FindFirstChild("Hitbox") then
        local interact = prompt.Hitbox:FindFirstChild("InteractPrompt")
        if interact then
            fireproximityprompt(interact)
            task.wait(1.2)
        end
    end
end

-- cancelar job (corrigido pro mobile)
local function cancelJob()
    local jobFrame = LocalPlayer.PlayerGui:WaitForChild("Main"):WaitForChild("GlobalFrame"):WaitForChild("Job")
    local cancelBtn = jobFrame:FindFirstChild("Cancel")

    if cancelBtn and cancelBtn:IsA("TextButton") then
        local absPos = cancelBtn.AbsolutePosition
        local absSize = cancelBtn.AbsoluteSize
        local clickX = absPos.X + absSize.X/2
        local clickY = absPos.Y + absSize.Y/2 + 55 -- offset manual

        VirtualInputManager:SendMouseButtonEvent(clickX, clickY, 0, true, game, 1)
        VirtualInputManager:SendMouseButtonEvent(clickX, clickY, 0, false, game, 1)

        warn("Missão cancelada com offset!")
        task.wait(0.7)
    else
        warn("Botão de cancel não encontrado!")
    end
end

-- checar qual missão pegou
local function getJobName()
    local jobGui = LocalPlayer.PlayerGui.Main.GlobalFrame.Job:FindFirstChild("Job")
    if jobGui and jobGui:IsA("TextLabel") then
        return (jobGui.Text or ""):lower()
    end
    return ""
end

-- depositar no banco
local function depositMoney()
    warn("Indo depositar no banco...")
    tpTo(bankPos)
    task.wait(1.5)

    -- ativa o ProximityPrompt do banco
    local prompt = workspace.Bank:FindFirstChild("ProximityPrompt")
    if prompt then
        fireproximityprompt(prompt)
        task.wait(1.2)
    end

    -- clica em "Deposit All"
    local bankGui = LocalPlayer.PlayerGui:WaitForChild("Bank"):WaitForChild("GlobalFrame"):WaitForChild("Bank")
    local depositAllBtn = bankGui:FindFirstChild("DepositAll")

    if depositAllBtn and depositAllBtn:IsA("TextButton") then
        local absPos = depositAllBtn.AbsolutePosition
        local absSize = depositAllBtn.AbsoluteSize
        local clickX = absPos.X + absSize.X/2
        local clickY = absPos.Y + absSize.Y/2 + 55

        VirtualInputManager:SendMouseButtonEvent(clickX, clickY, 0, true, game, 1)
        VirtualInputManager:SendMouseButtonEvent(clickX, clickY, 0, false, game, 1)

        warn("Dinheiro depositado com sucesso!")
        task.wait(2)
    else
        warn("Botão DepositAll não encontrado!")
    end

    -- volta pro Job Board
    tpTo(jobBoardPos)
end

-- completar missão Stocking Rampage
local function doStockingRampage()
    warn("Pegou Stocking Rampage!")
    tpTo(jobStep1)
    task.wait(2)
    tpTo(jobStep2)
    task.wait(2)
    tpTo(jobBoardPos)
end

-- completar missão Missing Cat
local function doMissingCat()
    warn("Pegou Missing Cat!")
    local catModel = workspace:FindFirstChild("Maxwellhaisbeks") and workspace.Maxwellhaisbeks:FindFirstChild("CatModel")
    if catModel then
        tpTo(catModel.Position + Vector3.new(0, 3, 0)) -- teleporta acima do gato
        task.wait(1)
        local catPrompt = catModel:FindFirstChild("CatPrompt")
        if catPrompt then
            fireproximityprompt(catPrompt)
            warn("Interagiu com o gato!")
        else
            warn("CatPrompt não encontrado!")
        end
    else
        warn("CatModel não encontrado!")
    end
    task.wait(2)
    tpTo(jobBoardPos)
end

-- controle de tempo do banco
local lastDeposit = tick()

-- loop principal
while task.wait(1) do
    -- checa se já passou 5 minutos
    if tick() - lastDeposit >= 300 then
        depositMoney()
        lastDeposit = tick()
    end

    tpTo(jobBoardPos)
    takeJob()

    local jobGui = LocalPlayer.PlayerGui.Main.GlobalFrame.Job:FindFirstChild("Job")
    local tries = 0
    while jobGui and (jobGui.Text == "" or jobGui.Text == nil) and tries < 20 do
        task.wait(0.5)
        tries += 1
    end

    local jobName = getJobName()

    if jobName:find("stocking rampage") then
        doStockingRampage()
    elseif jobName:find("missing cat") then
        doMissingCat()
    else
        warn("Missão errada, cancelando...")
        cancelJob()
    end
end
